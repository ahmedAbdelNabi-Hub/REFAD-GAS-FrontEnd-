<div class="px-4">
    <div class="mb-4 px-2">
        <p class="text-2xl font-bold py-8">إضافة دفعة جديدة</p>
    </div>

    <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()" class="px-3 flex flex-col gap-3">

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div *ngIf="!isCompanyUser" class="flex flex-col gap-2">
                <label for="companyId" class="font-bold text-sm">الشركة*</label>
                <div class="relative">
                    <select id="companyId" formControlName="companyId" [class]="'px-4 pl-10 placeholder:text-gray-400 text-sm w-full outline-none box-shadow py-3.5 rounded-xl border appearance-none ' + 
            (companyId?.invalid && companyId?.touched ? 'border-red-500' : 'border-[#ebecf5]')">
                        <option value="">اختر الشركة</option>
                        <option *ngFor="let company of companies" [value]="company.id">
                            {{ company.name }}
                        </option>
                    </select>
                    <i class='bx bx-buildings absolute left-3 top-1/2 -translate-y-1/2 text-xl text-[#667085]'></i>
                </div>
                <app-form-error [form]="paymentForm" controlName="companyId"></app-form-error>
            </div>
            <input type="hidden" *ngIf="isCompanyUser" formControlName="companyId">

            <!-- Amount -->
            <div class="flex flex-col gap-2">
                <label for="amount" class="font-bold text-sm">المبلغ (ريال)*</label>
                <div class="relative">
                    <input type="number" step="0.01" id="amount" formControlName="amount" placeholder="المبلغ" [class]="'px-4 pl-10 placeholder:text-gray-400 text-sm w-full outline-none box-shadow py-3.5 rounded-xl border ' + 
            (amount?.invalid && amount?.touched ? 'border-red-500' : 'border-[#ebecf5]')" />
                    <i class='bx bx-dollar absolute left-3 top-1/2 -translate-y-1/2 text-xl text-[#667085]'></i>
                </div>
                <app-form-error [form]="paymentForm" controlName="amount"></app-form-error>
            </div>

            <!-- Payment Type -->
            <div class="flex flex-col gap-2">
                <label for="paymentType" class="font-bold text-sm">نوع الدفع*</label>
                <div class="relative">
                    <select id="paymentType" formControlName="paymentType" [class]="'px-4 pl-10 placeholder:text-gray-400 text-sm w-full outline-none box-shadow py-3.5 rounded-xl border appearance-none ' + 
            (paymentType?.invalid && paymentType?.touched ? 'border-red-500' : 'border-[#ebecf5]')">
                        <option value="Transfer">تحويل بنكي</option>
                        <option value="Deposit">إيداع نقدي</option>
                        <option value="Cash">نقدي</option>
                    </select>
                    <i class='bx bx-credit-card absolute left-3 top-1/2 -translate-y-1/2 text-xl text-[#667085]'></i>
                </div>
                <app-form-error [form]="paymentForm" controlName="paymentType"></app-form-error>
            </div>
        </div>

        <!-- Row 2: Service Type & Reference Number -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Service Type -->
            <div class="flex flex-col gap-2">
                <label for="serviceType" class="font-bold text-sm">نوع الخدمة*</label>
                <div class="relative">
                    <select id="serviceType" formControlName="serviceType" [class]="'px-4 pl-10 placeholder:text-gray-400 text-sm w-full outline-none box-shadow py-3.5 rounded-xl border appearance-none ' + 
            (serviceType?.invalid && serviceType?.touched ? 'border-red-500' : 'border-[#ebecf5]')">
                        <option value="Fuel">وقود</option>
                        <option value="Services">خدمات</option>
                        <option value="Both">كلاهما</option>
                    </select>
                    <i class='bx bx-list-ul absolute left-3 top-1/2 -translate-y-1/2 text-xl text-[#667085]'></i>
                </div>
                <app-form-error [form]="paymentForm" controlName="serviceType"></app-form-error>
            </div>

            <!-- Reference Number -->
            <div class="flex flex-col gap-2">
                <label for="referenceNumber" class="font-bold text-sm">رقم المرجع</label>
                <div class="relative">
                    <input type="text" id="referenceNumber" formControlName="referenceNumber"
                        placeholder="رقم المرجع (اختياري)" [class]="'px-4 pl-10 placeholder:text-gray-400 text-sm w-full outline-none box-shadow py-3.5 rounded-xl border ' + 
            (referenceNumber?.invalid && referenceNumber?.touched ? 'border-red-500' : 'border-[#ebecf5]')" />
                    <i class='bx bx-hash absolute left-3 top-1/2 -translate-y-1/2 text-xl text-[#667085]'></i>
                </div>
                <app-form-error [form]="paymentForm" controlName="referenceNumber"></app-form-error>
            </div>

            <!-- Empty Spacer -->
            <div></div>
        </div>

        <!-- Row 3: Description -->
        <div class="grid grid-cols-1 md:grid-cols-1 gap-4 border-t border-gray-200 py-4">
            <div class="flex flex-col gap-2">
                <label for="description" class="font-bold text-sm">الوصف*</label>
                <div class="relative">
                    <textarea id="description" formControlName="description" rows="4" placeholder="وصف الدفعة"
                        [class]="'px-4 pl-10 placeholder:text-gray-400 text-sm w-full outline-none box-shadow py-3.5 rounded-xl border resize-vertical ' + 
                       (description?.invalid && description?.touched ? 'border-red-500' : 'border-[#ebecf5]')"></textarea>
                    <i class='bx bx-text absolute left-3 top-3 text-xl text-[#667085]'></i>
                </div>
                <app-form-error [form]="paymentForm" controlName="description"></app-form-error>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex items-center justify-end gap-4 pt-6 pb-6">
            <button type="submit"
                class="bg-[#00853e] text-white cursor-pointer px-6 py-2 rounded-md flex items-center gap-2 transition-colors font-medium text-sm hover:bg-[#007036]">
                <i class='bx bx-plus text-xl'></i>
                <span>إضافة الدفعة</span>
            </button>
            <button type="button" routerLink="/dashboard/payments"
                class="bg-[#ffffff] text-[#667085] cursor-pointer px-4 py-2 rounded-md flex items-center gap-0.5 border border-fuchsia-100 transition-colors font-medium text-sm hover:bg-gray-50">
                <i class='bx bx-x text-xl'></i>
                <span>إغلاق</span>
            </button>
        </div>
    </form>
</div>